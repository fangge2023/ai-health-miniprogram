<!--pages/dashboard/dashboard.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨é—®å€™å’Œæ—¥æœŸ -->
  <view class="header-section">
    <view class="greeting">
      <text class="greeting-text">{{greeting}}ï¼Œ{{userInfo.nickname || 'ç”¨æˆ·'}}</text>
      <text class="date-text">{{currentDate}}</text>
    </view>
    <view class="weather-info" wx:if="{{weather}}">
      <text class="weather-text">{{weather.temp}}Â°C {{weather.desc}}</text>
    </view>
  </view>

  <!-- ä½“é‡è¿›åº¦å¡ç‰‡ -->
  <view class="card stats-card">
    <view class="card-header">
      <text>å‡è‚¥è¿›åº¦</text>
      <text class="progress-percent">{{progressPercent}}%</text>
    </view>
    <view class="card-body">
      <view class="weight-display">
        <view class="current-weight">
          <text class="weight-value">{{currentWeight}}</text>
          <text class="weight-unit">kg</text>
        </view>
        <view class="weight-change" wx:if="{{weightChange}}">
          <text class="change-text {{weightChange > 0 ? 'positive' : 'negative'}}">
            {{weightChange > 0 ? '+' : ''}}{{weightChange}}kg
          </text>
        </view>
      </view>
      <view class="progress">
        <view class="progress-bar" style="width: {{progressPercent}}%"></view>
      </view>
      <view class="weight-goal">
        <text>ç›®æ ‡: {{targetWeight}}kg</text>
        <text>è¿˜éœ€: {{remainingWeight}}kg</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ•°æ®æ¦‚è§ˆ -->
  <view class="today-overview">
    <view class="overview-title">ä»Šæ—¥æ¦‚è§ˆ</view>
    <view class="overview-grid">
      <view class="overview-item">
        <view class="item-icon">ğŸ”¥</view>
        <view class="item-value">{{todayData.caloriesConsumed}}</view>
        <view class="item-label">å·²æ‘„å…¥</view>
        <view class="item-unit">kcal</view>
      </view>
      <view class="overview-item">
        <view class="item-icon">ğŸƒ</view>
        <view class="item-value">{{todayData.caloriesBurned}}</view>
        <view class="item-label">å·²æ¶ˆè€—</view>
        <view class="item-unit">kcal</view>
      </view>
      <view class="overview-item">
        <view class="item-icon">ğŸ‘£</view>
        <view class="item-value">{{todayData.steps}}</view>
        <view class="item-label">æ­¥æ•°</view>
        <view class="item-unit">æ­¥</view>
      </view>
      <view class="overview-item">
        <view class="item-icon">ğŸ’§</view>
        <view class="item-value">{{todayData.water}}</view>
        <view class="item-label">é¥®æ°´</view>
        <view class="item-unit">ml</view>
      </view>
    </view>
  </view>

  <!-- çƒ­é‡å¹³è¡¡å¡ç‰‡ -->
  <view class="card">
    <view class="card-header">
      <text>çƒ­é‡å¹³è¡¡</text>
      <text class="balance-status {{calorieBalance >= 0 ? 'surplus' : 'deficit'}}">
        {{calorieBalance >= 0 ? 'è¶…å‡º' : 'ä¸è¶³'}} {{Math.abs(calorieBalance)}}kcal
      </text>
    </view>
    <view class="card-body">
      <view class="calorie-chart-container">
        <ec-canvas id="calorie-chart" canvas-id="calorie-chart" ec="{{ calorieChart }}"></ec-canvas>
      </view>
      <view class="calorie-details">
        <view class="detail-item">
          <text class="detail-label">åŸºç¡€ä»£è°¢</text>
          <text class="detail-value">{{bmr}} kcal</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ç›®æ ‡æ‘„å…¥</text>
          <text class="detail-value">{{targetCalories}} kcal</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å‰©ä½™å¯æ‘„å…¥</text>
          <text class="detail-value">{{remainingCalories}} kcal</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä½“é‡è¶‹åŠ¿å›¾ -->
  <view class="card">
    <view class="card-header">
      <text>ä½“é‡è¶‹åŠ¿</text>
      <view class="chart-period">
        <text class="period-item {{chartPeriod === 'week' ? 'active' : ''}}" bindtap="changePeriod" data-period="week">å‘¨</text>
        <text class="period-item {{chartPeriod === 'month' ? 'active' : ''}}" bindtap="changePeriod" data-period="month">æœˆ</text>
        <text class="period-item {{chartPeriod === 'year' ? 'active' : ''}}" bindtap="changePeriod" data-period="year">å¹´</text>
      </view>
    </view>
    <view class="card-body">
      <view class="chart-container">
        <ec-canvas id="weight-chart" canvas-id="weight-chart" ec="{{ weightChart }}"></ec-canvas>
      </view>
    </view>
  </view>

  <!-- AIå»ºè®®å¡ç‰‡ -->
  <view class="card" wx:if="{{aiSuggestion}}">
    <view class="card-header">
      <text>AIæ™ºèƒ½å»ºè®®</text>
      <view class="ai-icon">ğŸ¤–</view>
    </view>
    <view class="card-body">
      <view class="suggestion-content">
        <text class="suggestion-text">{{aiSuggestion.content}}</text>
      </view>
      <view class="suggestion-actions">
        <button class="btn btn-outline btn-small" bindtap="viewMore">æŸ¥çœ‹è¯¦æƒ…</button>
        <button class="btn btn-primary btn-small" bindtap="goToAiConsult">AIå’¨è¯¢</button>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="action-title">å¿«æ·æ“ä½œ</view>
    <view class="action-grid">
      <view class="action-item" bindtap="quickRecord" data-type="weight">
        <view class="action-icon">âš–ï¸</view>
        <text class="action-text">è®°å½•ä½“é‡</text>
      </view>
      <view class="action-item" bindtap="quickRecord" data-type="meal">
        <view class="action-icon">ğŸ½ï¸</view>
        <text class="action-text">è®°å½•é¥®é£Ÿ</text>
      </view>
      <view class="action-item" bindtap="quickRecord" data-type="exercise">
        <view class="action-icon">ğŸƒ</view>
        <text class="action-text">è®°å½•è¿åŠ¨</text>
      </view>
      <view class="action-item" bindtap="quickRecord" data-type="water">
        <view class="action-icon">ğŸ’§</view>
        <text class="action-text">å–æ°´æé†’</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && !hasData}}">
    <view class="empty-icon">ğŸ“Š</view>
    <text class="empty-text">æš‚æ— æ•°æ®\nç‚¹å‡»å¿«æ·æ“ä½œå¼€å§‹è®°å½•</text>
  </view>
</view>