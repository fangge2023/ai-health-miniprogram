<!--pages/dashboard/dashboard.wxml-->
<view class="container">
  <!-- 顶部问候和日期 -->
  <view class="header-section">
    <view class="greeting">
      <text class="greeting-text">{{greeting}}，{{userInfo.nickname || '用户'}}</text>
      <text class="date-text">{{currentDate}}</text>
    </view>
    <view class="weather-info" wx:if="{{weather}}">
      <text class="weather-text">{{weather.temp}}°C {{weather.desc}}</text>
    </view>
  </view>

  <!-- 体重进度卡片 -->
  <view class="card stats-card">
    <view class="card-header">
      <text>减肥进度</text>
      <text class="progress-percent">{{progressPercent}}%</text>
    </view>
    <view class="card-body">
      <view class="weight-display">
        <view class="current-weight">
          <text class="weight-value">{{currentWeight}}</text>
          <text class="weight-unit">kg</text>
        </view>
        <view class="weight-change" wx:if="{{weightChange}}">
          <text class="change-text {{weightChange > 0 ? 'positive' : 'negative'}}">
            {{weightChange > 0 ? '+' : ''}}{{weightChange}}kg
          </text>
        </view>
      </view>
      <view class="progress">
        <view class="progress-bar" style="width: {{progressPercent}}%"></view>
      </view>
      <view class="weight-goal">
        <text>目标: {{targetWeight}}kg</text>
        <text>还需: {{remainingWeight}}kg</text>
      </view>
    </view>
  </view>

  <!-- 今日数据概览 -->
  <view class="today-overview">
    <view class="overview-title">今日概览</view>
    <view class="overview-grid">
      <view class="overview-item">
        <view class="item-icon">🔥</view>
        <view class="item-value">{{todayData.caloriesConsumed}}</view>
        <view class="item-label">已摄入</view>
        <view class="item-unit">kcal</view>
      </view>
      <view class="overview-item">
        <view class="item-icon">🏃</view>
        <view class="item-value">{{todayData.caloriesBurned}}</view>
        <view class="item-label">已消耗</view>
        <view class="item-unit">kcal</view>
      </view>
      <view class="overview-item">
        <view class="item-icon">👣</view>
        <view class="item-value">{{todayData.steps}}</view>
        <view class="item-label">步数</view>
        <view class="item-unit">步</view>
      </view>
      <view class="overview-item">
        <view class="item-icon">💧</view>
        <view class="item-value">{{todayData.water}}</view>
        <view class="item-label">饮水</view>
        <view class="item-unit">ml</view>
      </view>
    </view>
  </view>

  <!-- 热量平衡卡片 -->
  <view class="card">
    <view class="card-header">
      <text>热量平衡</text>
      <text class="balance-status {{calorieBalance >= 0 ? 'surplus' : 'deficit'}}">
        {{calorieBalance >= 0 ? '超出' : '不足'}} {{Math.abs(calorieBalance)}}kcal
      </text>
    </view>
    <view class="card-body">
      <view class="calorie-chart-container">
        <ec-canvas id="calorie-chart" canvas-id="calorie-chart" ec="{{ calorieChart }}"></ec-canvas>
      </view>
      <view class="calorie-details">
        <view class="detail-item">
          <text class="detail-label">基础代谢</text>
          <text class="detail-value">{{bmr}} kcal</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">目标摄入</text>
          <text class="detail-value">{{targetCalories}} kcal</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">剩余可摄入</text>
          <text class="detail-value">{{remainingCalories}} kcal</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 体重趋势图 -->
  <view class="card">
    <view class="card-header">
      <text>体重趋势</text>
      <view class="chart-period">
        <text class="period-item {{chartPeriod === 'week' ? 'active' : ''}}" bindtap="changePeriod" data-period="week">周</text>
        <text class="period-item {{chartPeriod === 'month' ? 'active' : ''}}" bindtap="changePeriod" data-period="month">月</text>
        <text class="period-item {{chartPeriod === 'year' ? 'active' : ''}}" bindtap="changePeriod" data-period="year">年</text>
      </view>
    </view>
    <view class="card-body">
      <view class="chart-container">
        <ec-canvas id="weight-chart" canvas-id="weight-chart" ec="{{ weightChart }}"></ec-canvas>
      </view>
    </view>
  </view>

  <!-- AI建议卡片 -->
  <view class="card" wx:if="{{aiSuggestion}}">
    <view class="card-header">
      <text>AI智能建议</text>
      <view class="ai-icon">🤖</view>
    </view>
    <view class="card-body">
      <view class="suggestion-content">
        <text class="suggestion-text">{{aiSuggestion.content}}</text>
      </view>
      <view class="suggestion-actions">
        <button class="btn btn-outline btn-small" bindtap="viewMore">查看详情</button>
        <button class="btn btn-primary btn-small" bindtap="goToAiConsult">AI咨询</button>
      </view>
    </view>
  </view>

  <!-- 快捷操作 -->
  <view class="quick-actions">
    <view class="action-title">快捷操作</view>
    <view class="action-grid">
      <view class="action-item" bindtap="quickRecord" data-type="weight">
        <view class="action-icon">⚖️</view>
        <text class="action-text">记录体重</text>
      </view>
      <view class="action-item" bindtap="quickRecord" data-type="meal">
        <view class="action-icon">🍽️</view>
        <text class="action-text">记录饮食</text>
      </view>
      <view class="action-item" bindtap="quickRecord" data-type="exercise">
        <view class="action-icon">🏃</view>
        <text class="action-text">记录运动</text>
      </view>
      <view class="action-item" bindtap="quickRecord" data-type="water">
        <view class="action-icon">💧</view>
        <text class="action-text">喝水提醒</text>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>加载中...</text>
  </view>

  <!-- 空状态 -->
  <view class="empty" wx:if="{{!loading && !hasData}}">
    <view class="empty-icon">📊</view>
    <text class="empty-text">暂无数据\n点击快捷操作开始记录</text>
  </view>
</view>